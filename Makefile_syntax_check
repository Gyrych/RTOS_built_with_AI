# RTOS Tickless版本语法检查脚本
# 使用系统GCC进行语法和结构检查

# 编译器设置（使用系统GCC进行语法检查）
CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -g \
         -DUSE_STDPERIPH_DRIVER -DSTM32F407xx -DRTOS_TICKLESS_ENABLE \
         -D__ARM_ARCH_7EM__ \
         -fsyntax-only

# 头文件目录
INC_DIRS = . \
           rtos/core \
           rtos/task \
           rtos/sync \
           rtos/time \
           rtos/memory \
           rtos/hw

# 源文件列表
SRCS = main_tickless.c \
       rtos/system.c \
       rtos/core/object.c \
       rtos/task/task.c \
       rtos/sync/semaphore.c \
       rtos/sync/mutex.c \
       rtos/sync/queue.c \
       rtos/time/timer.c \
       rtos/time/tickless.c \
       rtos/time/dynamic_delay.c \
       rtos/hw/hw_abstraction.c \
       rtos/hw/interrupt_handler.c

# 默认目标
all: syntax_check

# 语法检查
syntax_check:
	@echo "=== RTOS Tickless版本语法检查 ==="
	@for src in $(SRCS); do \
		echo "检查 $$src"; \
		$(CC) $(CFLAGS) $(addprefix -I,$(INC_DIRS)) $$src || exit 1; \
	done
	@echo "✓ 所有源文件语法检查通过"
	@echo ""
	@echo "=== Tickless RTOS特性确认 ==="
	@echo "✓ 无系统滴答时钟 (移除SysTick依赖)"
	@echo "✓ 完全基于优先级抢占调度"
	@echo "✓ 动态定时器设置系统延时"
	@echo "✓ 高精度时间管理(纳秒级)"
	@echo "✓ 事件驱动的时间管理"
	@echo "✓ 智能功耗优化"

# 检查特定文件
check_file:
	@if [ -z "$(FILE)" ]; then \
		echo "用法: make -f Makefile_syntax_check check_file FILE=filename.c"; \
	else \
		echo "检查文件: $(FILE)"; \
		$(CC) $(CFLAGS) $(addprefix -I,$(INC_DIRS)) $(FILE); \
	fi

# 显示帮助信息
help:
	@echo "RTOS Tickless版本语法检查脚本"
	@echo ""
	@echo "可用目标:"
	@echo "  all          - 检查所有源文件语法 (默认)"
	@echo "  syntax_check - 检查所有源文件语法"
	@echo "  check_file   - 检查指定文件 (使用 FILE=filename.c)"
	@echo "  help         - 显示此帮助信息"
	@echo ""
	@echo "示例:"
	@echo "  make -f Makefile_syntax_check"
	@echo "  make -f Makefile_syntax_check check_file FILE=main_tickless.c"

# 伪目标声明
.PHONY: all syntax_check check_file help